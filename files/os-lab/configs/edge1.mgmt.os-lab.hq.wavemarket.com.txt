version 17.3R3.10;
system {
    host-name edge1;
    domain-name os-lab.hq.wavemarket.com;
    time-zone UTC;
    root-authentication {
        encrypted-password "$5$vvjrjJ48$Hn6nQba9MI.iY0w922o3Ba8//pF2BuUsjNnqk/Qlua1"; ## SECRET-DATA
    }
    login {
        class RANCID {
            permissions [ access admin firewall flow-tap interface network routing secret security snmp storage system trace view view-configuration ];
        }
        user david.selders {
            uid 1001;
            class super-user;
            authentication {
                ssh-rsa "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDRqoUoOtQ7k9HIETWLtgnbZpciXcu/MLLLAnTIkgW6lWKdsd1yMp8r1pM0ykRZpAaSup39HxTzK+7U4x49RgcCUn2/M4EYV33jzkp/m6Jb6dqXQtPtMNWvmvsBZf8PhZsr/jMIAQ6tX6m+9yrVkvRWQsZSSaAsxoI/LJUWH7GX4TmJoUcMD2ZQWLJWIwIfv2DNv8x6lxB7AZGDQfD+7+swWoFxnfsu/164QJiUWQyub2tRQUEskNsebwPiPzigO4LqCTD+A8POz0BzM5i+bJ1yU5Obr0h1CyBMpThCJAso7MKBQHB5ZYd2A/0ZJUBB2DVfsp360ScRYyMv8prsp9WYQqKRTqoRegOFucpBz6XdjrvzaiS5uL2jpyzod8PAmdXlsGCjHvKyWGMmv0YQjrcZ5qTlBGCKshDKnFNKjaeUXULpgVv9XQ85nlZy1+NOcWoelYopHU+/rRiH3AVVjxshoxD6zh9aQMzSPU0Gs5PaL+lcaHMD4FK8va9zamZ0WP9uaaT8uM6i/+LsP7FMZlLyzfaxGztJPMZznusEX6Af4Iwnub/i46hYPeXXbEA0O85Xd6OMNDr5CpKDB1QkxKsCXWGxuHcoHFMzWOMoKuncNyjULTadUQh2qreC1sgkVUESdpe+nRiVBlpTYitWjF5zz2eubImkJaFc0inCAzCDJw== david.selders@locationlabs.com"; ## SECRET-DATA
            }
        }
        user rancid {
            full-name RANCID;
            uid 2001;
            class RANCID;
            authentication {
                ssh-rsa "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDoqCebUtvf/AYgnhvu2sWjCculvumpeauTkjeZvAVn/cjX4y4BsDqs+BhaOBbDMFt2pajaGreN6Vcnxrq/fGF3aSjWbz/4PwJlk0Xawgg1yz2Qe8p8KEuE2iT1pfWFbU2tBQVR0F2VW/deVhfxVZoX3yXyA3ayZZkLhZxHr6voGf3UfIRmhnPxz/NQio/2qdwTFtMUJl381Sqc5qUCIVAhwPmwfD/If00ffMWRfRLHlG7DLwXKNhcoUEur/dv0xFVvrUXun32Zo9fV1Lnmehb2BSWOaV9q9XODV+y5fg18XTYtF7R7c/lfPgiEwSoat9m+grTLMKtVjckEiEULfRX9fFQIkEz6DezAXI07jiJCVsA+16d1MfvgTRneBv9LeE4E4iNEnnC0EEXg0C3aedtvq2Qrkw23t1HgwW8ebFceBFo4hWviFoxnh06hHsPVT5J9e5Ut7Xs4S17FHucJIocpR1VWCFir/Hmmjo/oPCY/HKDTV+/YCbtBX2jhzSkLE5S1XJRzzIgJrpt9vbWpnxbyAesAwbxKLSUnEJmItfWls0D9RgexWUehafjDzgUQnYjpw2ax2cgU5O6sn9is89ednxgBVElS5JvN5IxndG25nlHi7/hg6wvGnK7WmNHBhKB6HeR1y4aVQn1KcujIsVwZkGg4tJmtJWZ5xiA5sFWWhQ== rancid@ig-deploy"; ## SECRET-DATA
            }
        }
    }
    services {
        ssh {
            root-login allow;
        }
        netconf {
            ssh;
        }
    }
    syslog {
        user * {
            any emergency;
        }
        host 10.38.32.51 {
            any info;
            port 5046;
        }
        file messages {
            any any;
            authorization info;
        }
        file interactive-commands {
            interactive-commands any;
        }
        source-address 10.38.32.17;
    }
    license {
        autoupdate {
            url https://ae1.juniper.net/junos/key_retrieval;
        }
    }
}
chassis {
    aggregated-devices {
        ethernet {
            device-count 1;
        }
    }
}
interfaces {
    ge-0/0/0 {
        unit 0 {
            description Level3;
            family inet {
                filter {
                    input ssh_access;
                }
                address 4.35.160.50/29;
            }
        }
    }
    ge-0/0/2 {
        vlan-tagging;
        unit 1498 {
            description "Underclcoud lab2 interconnect (edge1 <--> mgmt-edge1)";
            vlan-id 1498;
            family inet {
                address 169.254.254.3/31;
            }
        }
        unit 1499 {
            description "Underclcoud lab1 interconnect (edge1 <--> mgmt-edge1)";
            vlan-id 1499;
            family inet {
                address 169.254.254.1/31;
            }
        }
    }
    xe-2/0/0 {
        gigether-options {
            802.3ad ae0;
        }
    }
    xe-2/0/1 {
        gigether-options {
            802.3ad ae0;
        }
    }
    ae0 {
        description "Edge1 <--> Core1 interconnect";
        vlan-tagging;
        aggregated-ether-options {
            lacp {
                passive;
                periodic fast;
            }
        }
        unit 1502 {
            description "Level3 (edge1 <--> core1)";
            vlan-id 1502;
            family inet {
                address 10.38.47.217/29;
            }
        }
        unit 1504 {
            vlan-id 1504;
            family inet {
                address 10.38.47.192/31;
            }
        }
        unit 1604 {
            vlan-id 1604;
            family inet {
                address 10.38.47.200/31;
            }
        }
    }
    fxp0 {
        unit 0 {
            description Mgmt;
            family inet {
                address 10.38.32.17/25;
            }
        }
    }
    lo0 {
        unit 0 {
            description "Global instance loopback";
            family inet {
                address 10.38.47.253/32;
            }
        }
        unit 1 {
            description "Undercloud instance loopback";
            family inet {
                address 10.38.47.226/32;
            }
        }
        unit 2 {
            family inet {
                address 10.38.47.228/32;
            }
        }
    }
}
routing-options {
    static {
        route 0.0.0.0/0 next-hop 4.35.160.49;
    }
    router-id 10.38.47.253;
    autonomous-system 63388;
}
protocols {
    bgp {
        group iBGP {
            type internal;
            export generate-default;
            neighbor 10.38.47.218;
        }
        group Level3 {
            type external;
            import Level3-IN;
            export Level3-OUT;
            neighbor 4.35.160.49 {
                peer-as 3356;
            }
        }
    }
    lldp {
        interface all;
        interface ge-0/0/1 {
            disable;
        }
    }
}
policy-options {
    policy-statement Level3-IN {
        term AllowLevel3 {
            from protocol bgp;
            then accept;
        }
        then reject;
    }
    policy-statement Level3-OUT {
        term Wavemarket {
            from {
                protocol bgp;
                route-filter 8.44.176.0/24 exact;
            }
            then accept;
        }
        then reject;
    }
    policy-statement generate-default {
        term 10 {
            from {
                protocol static;
                route-filter 0.0.0.0/0 exact;
            }
            then {
                next-hop self;
                accept;
            }
        }
        then reject;
    }
    policy-statement set-next-hop-self {
        term 10 {
            from protocol bgp;
            then {
                next-hop self;
                accept;
            }
        }
        then reject;
    }
}
firewall {
    family inet {
        filter ssh_access {
            term HQ {
                from {
                    source-address {
                        4.35.160.53/32;
                    }
                    protocol tcp;
                    port ssh;
                }
                then accept;
            }
            term 10.0.0.0/8 {
                from {
                    source-address {
                        10.0.0.0/8;
                    }
                    protocol tcp;
                    port ssh;
                }
                then accept;
            }
            term 172.16.0.0/12 {
                from {
                    source-address {
                        172.16.0.0/12;
                    }
                    protocol tcp;
                    port ssh;
                }
                then accept;
            }
            term 192.168.0.0/16 {
                from {
                    source-address {
                        192.168.0.0/16;
                    }
                    protocol tcp;
                    port ssh;
                }
                then accept;
            }
            term reject_all {
                from {
                    protocol tcp;
                    port ssh;
                }
                then {
                    log;
                    reject;
                }
            }
            term default_allow {
                then accept;
            }
        }
    }
}
routing-instances {
    Undercloud-lab1 {
        instance-type virtual-router;
        interface ge-0/0/2.1499;
        interface ae0.1504;
        interface lo0.1;
        routing-options {
            router-id 10.38.47.226;
            autonomous-system 63388;
        }
        protocols {
            bgp {
                group iBGP {
                    type internal;
                    local-address 10.38.47.226;
                    export set-next-hop-self;
                    neighbor 10.38.47.225;
                }
                group DC-Mgmt {
                    type external;
                    neighbor 169.254.254.0 {
                        peer-as 65002;
                    }
                }
            }
            ospf {
                reference-bandwidth 100g;
                area 0.0.0.0 {
                    interface lo0.1 {
                        passive;
                    }
                    interface ae0.1504 {
                        interface-type p2p;
                    }
                }
            }
        }
    }
    Undercloud-lab2 {
        instance-type virtual-router;
        interface ge-0/0/2.1498;
        interface ae0.1604;
        interface lo0.2;
        routing-options {
            router-id 10.38.47.228;
            autonomous-system 63388;
        }
        protocols {
            bgp {
                group iBGP {
                    type internal;
                    local-address 10.38.47.228;
                    export set-next-hop-self;
                    neighbor 10.38.47.227;
                }
                group DC-Mgmt {
                    type external;
                    neighbor 169.254.254.2 {
                        peer-as 65002;
                    }
                }
            }
            ospf {
                reference-bandwidth 100g;
                area 0.0.0.0 {
                    interface lo0.2 {
                        passive;
                    }
                    interface ae0.1604 {
                        interface-type p2p;
                    }
                }
            }
        }
    }
}
