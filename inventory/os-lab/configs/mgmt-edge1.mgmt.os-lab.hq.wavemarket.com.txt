version 15.1X49-D130.6;
system {
    host-name mgmt-edge1-r02;
    root-authentication {
        encrypted-password "$5$F3.DDNiP$uiOgY3Jgs5/piaUdrA8epJcKYe27y5YLNJ1GJUiYaW3"; ## SECRET-DATA
    }
    login {
        class RANCID {
            permissions [ access admin firewall flow-tap interface network routing secret security snmp storage system trace view view-configuration ];
        }
        user david.selders {
            uid 2001;
            class super-user;
            authentication {
                ssh-rsa "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDRqoUoOtQ7k9HIETWLtgnbZpciXcu/MLLLAnTIkgW6lWKdsd1yMp8r1pM0ykRZpAaSup39HxTzK+7U4x49RgcCUn2/M4EYV33jzkp/m6Jb6dqXQtPtMNWvmvsBZf8PhZsr/jMIAQ6tX6m+9yrVkvRWQsZSSaAsxoI/LJUWH7GX4TmJoUcMD2ZQWLJWIwIfv2DNv8x6lxB7AZGDQfD+7+swWoFxnfsu/164QJiUWQyub2tRQUEskNsebwPiPzigO4LqCTD+A8POz0BzM5i+bJ1yU5Obr0h1CyBMpThCJAso7MKBQHB5ZYd2A/0ZJUBB2DVfsp360ScRYyMv8prsp9WYQqKRTqoRegOFucpBz6XdjrvzaiS5uL2jpyzod8PAmdXlsGCjHvKyWGMmv0YQjrcZ5qTlBGCKshDKnFNKjaeUXULpgVv9XQ85nlZy1+NOcWoelYopHU+/rRiH3AVVjxshoxD6zh9aQMzSPU0Gs5PaL+lcaHMD4FK8va9zamZ0WP9uaaT8uM6i/+LsP7FMZlLyzfaxGztJPMZznusEX6Af4Iwnub/i46hYPeXXbEA0O85Xd6OMNDr5CpKDB1QkxKsCXWGxuHcoHFMzWOMoKuncNyjULTadUQh2qreC1sgkVUESdpe+nRiVBlpTYitWjF5zz2eubImkJaFc0inCAzCDJw== david.selders@locationlabs.com"; ## SECRET-DATA
            }
        }
        user peter.pletcher {
            uid 2000;
            class super-user;
            authentication {
                ssh-rsa "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQCoeELibgrP7LBpFKChyotKddgZ2MwairR3Q0Ixul8NBHxpwrNi038RN13NHnUMK3AfTKeX+Ch4FcD3G9bQykUfzZNJ7JZHtbTvQ27adn6+HDOd14uckK7fCI2cpQ8/Bt6+H4U4K7ThWLMC9UsM+Mro4+PWBKM4n014Fi5k5KrfkW88rBhHM9uLLAX2e9/zcOafddSU9Zl5R68DLCgFIxzIdd2rL8sjye4s50avLHeX77az8hNQwdVSxd58TS+iXU3/PsFYkWSvL52WBQv+HXNRWieufO9vOdL5sBCE9kSHcz+LedyDDdJphqv+ZatWK1xOSiCTK8qeduqND+TXB84Es01NYGYad48h7tti0SU4HDcyw9gbkNKi2ktURZmL2rGPBfkdKFsNuh3PQntkgRx14NwvW8VHsf18vVM9tSmHOPahIUi4rQ1HPpAbDquoriva/rC9qVlgxJepzsGPOWXKGXSctUOQLVlCWaln9mKTFwo0wBIwrCcSeGTZL74MHhl1PsU0zQqAX800PUPDs/DXq3kQs/Pbf/sLQWV3c4dc3A8B1qWA2BWHKx3XdlXbO9SxOHiSxr2tnyNWpyR8xJ5ufaJXDSXV0/pbKaFyoW9zgqO50QX8tV7ETN48t1ANkz14yc27Homddn8I8JyPfN/B77zQwqVQOf9fKqMNTwXPCQ== peter.pletcher@peterpletcher-lt"; ## SECRET-DATA
            }
        }
        user rancid {
            uid 2002;
            class RANCID;
            authentication {
                ssh-rsa "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDoqCebUtvf/AYgnhvu2sWjCculvumpeauTkjeZvAVn/cjX4y4BsDqs+BhaOBbDMFt2pajaGreN6Vcnxrq/fGF3aSjWbz/4PwJlk0Xawgg1yz2Qe8p8KEuE2iT1pfWFbU2tBQVR0F2VW/deVhfxVZoX3yXyA3ayZZkLhZxHr6voGf3UfIRmhnPxz/NQio/2qdwTFtMUJl381Sqc5qUCIVAhwPmwfD/If00ffMWRfRLHlG7DLwXKNhcoUEur/dv0xFVvrUXun32Zo9fV1Lnmehb2BSWOaV9q9XODV+y5fg18XTYtF7R7c/lfPgiEwSoat9m+grTLMKtVjckEiEULfRX9fFQIkEz6DezAXI07jiJCVsA+16d1MfvgTRneBv9LeE4E4iNEnnC0EEXg0C3aedtvq2Qrkw23t1HgwW8ebFceBFo4hWviFoxnh06hHsPVT5J9e5Ut7Xs4S17FHucJIocpR1VWCFir/Hmmjo/oPCY/HKDTV+/YCbtBX2jhzSkLE5S1XJRzzIgJrpt9vbWpnxbyAesAwbxKLSUnEJmItfWls0D9RgexWUehafjDzgUQnYjpw2ax2cgU5O6sn9is89ednxgBVElS5JvN5IxndG25nlHi7/hg6wvGnK7WmNHBhKB6HeR1y4aVQn1KcujIsVwZkGg4tJmtJWZ5xiA5sFWWhQ== rancid@ig-deploy"; ## SECRET-DATA
            }
        }
    }
    services {
        ssh;
        netconf {
            ssh;
        }
    }
    syslog {
        archive size 100k files 3;
        user * {
            any emergency;
        }
        host 10.38.32.51 {
            any info;
            port 5046;
        }
        file messages {
            any notice;
            authorization info;
        }
        file interactive-commands {
            interactive-commands any;
        }
        source-address 10.38.32.13;
    }
    max-configurations-on-flash 5;
    max-configuration-rollbacks 5;
    license {
        autoupdate {
            url https://ae1.juniper.net/junos/key_retrieval;
        }
    }
    phone-home {
        server https://redirect.juniper.net;
        rfc-complaint;
    }
}
security {
    log {
        mode stream;
        report;
    }
    ike {
        proposal ike-prop-vpn-oslab-0 {
            authentication-method pre-shared-keys;
            dh-group group2;
            authentication-algorithm sha1;
            encryption-algorithm aes-256-cbc;
        }
        policy ike-pol-vpn-oslab-0 {
            mode main;
            proposals ike-prop-vpn-oslab-0;
            pre-shared-key ascii-text "$9$SXryK8ws4ZDkoJH.mPQzeKMLX-YgJUDHTzSlMW-d5Qz3CtRhr"; ## SECRET-DATA
        }
        gateway gw-vpn-oslab-0 {
            ike-policy ike-pol-vpn-oslab-0;
            address 66.211.110.193;
            external-interface ge-0/0/4;
        }
    }
    ipsec {
        proposal ipsec-prop-vpn-oslab-0 {
            protocol esp;
            authentication-algorithm hmac-sha1-96;
            encryption-algorithm aes-256-cbc;
            lifetime-seconds 3600;
        }
        policy ipsec-pol-vpn-oslab-0 {
            proposals ipsec-prop-vpn-oslab-0;
        }
        vpn vpn-oslab-0 {
            bind-interface st0.0;
            df-bit clear;
            ike {
                gateway gw-vpn-oslab-0;
                ipsec-policy ipsec-pol-vpn-oslab-0;
            }
            establish-tunnels immediately;
        }
    }
    address-book {
        global {
            address OS_ControlPlane1 10.38.32.128/27;
            address OS_ControlPlane2 10.38.32.160/27;
            address OS_ExternalNetwork1 10.38.40.0/27;
            address OS_ExternalNetwork2 10.38.40.32/27;
            address mgmt-net 10.38.32.0/25;
            address ns1.evidc 10.39.3.53/32;
            address ns2.evidc 10.39.3.54/32;
            address lab1_horizon_vip 10.38.40.2/32;
            address lab2_horizon_vip 10.38.40.34/32;
            address-set OS_ControlPlanes {
                address OS_ControlPlane1;
                address OS_ControlPlane2;
            }
            address-set OS_ExternalNetworks {
                address OS_ExternalNetwork1;
                address OS_ExternalNetwork2;
            }
        }
    }
    screen {
        ids-option untrust-screen {
            icmp {
                ping-death;
            }
            ip {
                source-route-option;
                tear-drop;
            }
            tcp {
                syn-flood {
                    alarm-threshold 1024;
                    attack-threshold 200;
                    source-threshold 1024;
                    destination-threshold 2048;
                    timeout 20;
                }
                land;
            }
        }
    }
    nat {
        source {
            rule-set trust-to-untrust {
                from zone trust;
                to zone untrust;
                rule source-nat-rule {
                    match {
                        source-address 0.0.0.0/0;
                    }
                    then {
                        source-nat {
                            interface;
                        }
                    }
                }
            }
        }
    }
    policies {
        from-zone trust to-zone trust {
            policy trust-to-trust {
                match {
                    source-address any;
                    destination-address any;
                    application any;
                }
                then {
                    permit;
                }
            }
        }
        from-zone trust to-zone untrust {
            policy trust-to-untrust {
                match {
                    source-address any;
                    destination-address any;
                    application any;
                }
                then {
                    permit;
                }
            }
        }
        from-zone control_plane to-zone dataplane {
            policy allowICMP {
                match {
                    source-address any;
                    destination-address any;
                    application junos-icmp-all;
                }
                then {
                    permit;
                }
            }
            policy allowHTTP {
                match {
                    source-address OS_ControlPlanes;
                    destination-address any;
                    application [ junos-http junos-https ];
                }
                then {
                    permit;
                }
            }
        }
        from-zone dataplane to-zone control_plane {
            policy allowICMP {
                match {
                    source-address any;
                    destination-address any;
                    application junos-icmp-all;
                }
                then {
                    permit;
                }
            }
        }
        from-zone dataplane to-zone trust {
            policy allowICMP {
                match {
                    source-address any;
                    destination-address any;
                    application junos-icmp-all;
                }
                then {
                    permit;
                }
            }
            policy allowNTP {
                match {
                    source-address OS_ExternalNetworks;
                    destination-address mgmt-net;
                    application junos-ntp;
                }
                then {
                    permit;
                }
            }
            policy allowIPMI {
                match {
                    source-address OS_ExternalNetworks;
                    destination-address mgmt-net;
                    application ipmi;
                }
                then {
                    permit;
                }
            }
        }
        from-zone control_plane to-zone trust {
            policy allowNTP {
                match {
                    source-address OS_ControlPlanes;
                    destination-address mgmt-net;
                    application junos-ntp;
                }
                then {
                    permit;
                }
            }
            policy allowHTTP {
                match {
                    source-address OS_ControlPlanes;
                    destination-address any;
                    application [ junos-http junos-https ];
                }
                then {
                    permit;
                }
            }
            policy allowDNS {
                match {
                    source-address OS_ControlPlanes;
                    destination-address [ ns1.evidc ns2.evidc ];
                    application [ junos-dns-udp junos-dns-tcp ];
                }
                then {
                    permit;
                }
            }
            policy AllowICMP {
                match {
                    source-address any;
                    destination-address any;
                    application junos-icmp-all;
                }
                then {
                    permit;
                }
            }
        }
        from-zone trust to-zone dataplane {
            policy allowICMP {
                match {
                    source-address any;
                    destination-address any;
                    application junos-icmp-all;
                }
                then {
                    permit;
                }
            }
            policy HorizonAPI {
                match {
                    source-address any;
                    destination-address [ lab1_horizon_vip lab2_horizon_vip ];
                    application any;
                }
                then {
                    permit;
                }
            }
        }
    }
    zones {
        security-zone trust {
            host-inbound-traffic {
                system-services {
                    all;
                }
                protocols {
                    all;
                }
            }
            interfaces {
                lo0.0;
                ge-0/0/5.1500;
                ge-0/0/0.0;
                st0.0;
            }
        }
        security-zone untrust {
            screen untrust-screen;
            host-inbound-traffic {
                system-services {
                    ping;
                    traceroute;
                    ike;
                }
            }
            interfaces {
                ge-0/0/4.0;
            }
        }
        security-zone dataplane {
            host-inbound-traffic {
                system-services {
                    ping;
                    traceroute;
                }
                protocols {
                    bgp;
                }
            }
            interfaces {
                ge-0/0/3.1499;
                ge-0/0/3.1498;
            }
        }
        security-zone control_plane {
            host-inbound-traffic {
                system-services {
                    ping;
                    traceroute;
                }
            }
            interfaces {
                ge-0/0/5.1514;
                ge-0/0/5.1614;
            }
        }
    }
}
interfaces {
    ge-0/0/0 {
        unit 0 {
            description "Device Management";
            family inet {
                address 10.38.32.13/25;
            }
        }
    }
    ge-0/0/3 {
        vlan-tagging;
        unit 1498 {
            description "Link to frontside network lab2";
            vlan-id 1498;
            family inet {
                address 169.254.254.2/31;
            }
        }
        unit 1499 {
            description "Link to frontside network lab1";
            vlan-id 1499;
            family inet {
                address 169.254.254.0/31;
            }
        }
    }
    ge-0/0/4 {
        unit 0 {
            description "Internet uplink (Level3)";
            family inet {
                address 4.35.160.52/29;
            }
        }
    }
    ge-0/0/5 {
        vlan-tagging;
        unit 1500 {
            description "DC Management GW";
            vlan-id 1500;
            family inet {
                address 10.38.32.1/25;
            }
        }
        unit 1514 {
            description "Lab1 ControlPlane GW";
            vlan-id 1514;
            family inet {
                address 10.38.32.129/27;
            }
        }
        unit 1614 {
            description "Lab2 ControlPlane GW";
            vlan-id 1614;
            family inet {
                address 10.38.32.161/27;
            }
        }
    }
    lo0 {
        unit 0 {
            family inet {
                address 10.38.47.254/32;
            }
        }
    }
    st0 {
        unit 0 {
            family inet {
                address 169.254.254.7/31;
            }
        }
    }
}
routing-options {
    static {
        route 0.0.0.0/0 next-hop 4.35.160.49;
        route 10.38.32.0/21 {
            discard;
            no-install;
        }
    }
    router-id 10.38.47.254;
    autonomous-system 65002;
}
protocols {
    bgp {
        group EVDC {
            export OSLAB-Mgmt-out;
            neighbor 169.254.254.6 {
                peer-as 65000;
            }
        }
        group DC-Mgmt {
            export mgmt-horizon-out;
            neighbor 169.254.254.1 {
                peer-as 63388;
            }
            neighbor 169.254.254.3 {
                peer-as 63388;
            }
        }
    }
    lldp {
        interface all;
        interface ge-0/0/4 {
            disable;
        }
    }
    rstp {
        interface all;
    }
}
policy-options {
    policy-statement OSLAB-Mgmt-out {
        term Mgmt {
            from {
                protocol static;
                route-filter 10.38.32.0/21 orlonger;
            }
            then accept;
        }
        term Deny {
            then reject;
        }
    }
    policy-statement mgmt-horizon-out {
        term ControlPlane1 {
            from {
                protocol direct;
                route-filter 10.38.32.128/27 exact;
            }
            then accept;
        }
        term ControlPlane2 {
            from {
                protocol direct;
                route-filter 10.38.32.160/27 exact;
            }
            then accept;
        }
        term DC-Mgmt {
            from {
                protocol direct;
                route-filter 10.38.32.0/25 orlonger;
            }
            then accept;
        }
        then reject;
    }
}
applications {
    application ipmi {
        protocol udp;
        destination-port 623;
    }
}
vlans {
    dcmgmt {
        vlan-id 1500;
    }
    lab1ctlplane {
        vlan-id 1504;
    }
}
